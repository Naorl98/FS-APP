<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Formula Sheet Creator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
      function showProgress(task_id) {
        document.getElementById("progress-container").style.display = "block";
        const progressBar = document.getElementById("progress");
        const progressValue = document.getElementById("progress-value");

        const interval = setInterval(() => {
          fetch(`/progress/${task_id}`)
            .then(response => response.json())
            .then(data => {
              progressBar.value = data.progress;
              progressValue.innerText = data.progress + "%";
              if (data.progress >= 100) {
                clearInterval(interval);
              }
            });
        }, 1000);
      }

      function handleFormSubmit(event) {
        const task_id = crypto.randomUUID();
        document.getElementById("task_id").value = task_id;
        showProgress(task_id);
      }
    </script>
</head>
<body>
    <h1>Formula Sheet Creator</h1>

    <!-- Progress Bar -->
    <div id="progress-container" style="display:none; margin-top: 20px;">
      <label for="progress">Progress:</label>
      <progress id="progress" value="0" max="100"></progress>
      <span id="progress-value">0%</span>
    </div>

    <form action="/" method="post" enctype="multipart/form-data" onsubmit="handleFormSubmit(event)">
        <label>Upload PDF file(s):</label><br>
        <input type="file" name="pdfs" accept="application/pdf" multiple required><br>

        <label>Scale percentage (e.g. 10):</label><br>
        <input type="number" name="scale" placeholder="Enter %" min="1" max="100" required><br>

        <label>Output filename (optional):</label><br>
        <input type="text" name="output_name" placeholder="output.pdf"><br>

        <label>Highlight color:</label><br>
        <select name="highlight">
            <option value="None">None</option>
            <option value="Yellow">Yellow</option>
            <option value="Green">Green</option>
            <option value="Blue">Blue</option>
            <option value="Pink">Pink</option>
            <option value="Cyan">Cyan</option>
        </select><br>

        <label>
            <input type="checkbox" name="clean">
            Do not delete white rows/columns
        </label><br><br>

        <!-- Hidden task_id -->
        <input type="hidden" name="task_id" id="task_id">

        <button type="submit">Generate Formula Sheet</button>
    </form>
</body>
</html>